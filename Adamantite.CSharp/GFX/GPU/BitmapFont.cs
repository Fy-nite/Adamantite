using System;

namespace Adamantite.GPU
{
    // Very small built-in monospace 8x8 bitmap font for ASCII 32..127
    public class BitmapFont
    {
        public int CharWidth => 8;
        public int CharHeight => 8;

        // Simple mapping for ASCII characters. Each byte is a row (8 bits -> pixels).
        // For brevity, this only contains digits, letters and a few punctuation. Unknown chars map to blank.
        private readonly System.Collections.Generic.Dictionary<char, byte[]> _glyphs = new();

        public BitmapFont()
        {
            // Populate a more complete clean 8x8 glyph set (uppercase letters, digits and common punctuation).
            _glyphs[' '] = new byte[] {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
            _glyphs['!'] = new byte[] {0x18,0x18,0x18,0x18,0x18,0x00,0x18,0x00};
            _glyphs['@'] = new byte[] {0x3C,0x42,0x5A,0x56,0x5A,0x40,0x3C,0x00};
            _glyphs['#'] = new byte[] {0x24,0x24,0x7E,0x24,0x7E,0x24,0x24,0x00};
            _glyphs['%'] = new byte[] {0x42,0x64,0x08,0x10,0x26,0x42,0x00,0x00};
            _glyphs['^'] = new byte[] {0x18,0x24,0x42,0x00,0x00,0x00,0x00,0x00};
            _glyphs['&'] = new byte[] {0x30,0x48,0x48,0x30,0x4A,0x44,0x3A,0x00};
            _glyphs['*'] = new byte[] {0x24,0x18,0x7E,0x18,0x7E,0x18,0x24,0x00};
            _glyphs['('] = new byte[] {0x0C,0x18,0x18,0x18,0x18,0x18,0x0C,0x00};
            _glyphs[')'] = new byte[] {0x30,0x18,0x18,0x18,0x18,0x18,0x30,0x00};
            _glyphs['-'] = new byte[] {0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00};
            _glyphs['_'] = new byte[] {0x00,0x00,0x00,0x00,0x00,0x00,0x7E,0x00};
            _glyphs['='] = new byte[] {0x00,0x00,0x7E,0x00,0x7E,0x00,0x00,0x00};
            _glyphs['+'] = new byte[] {0x00,0x18,0x18,0x7E,0x18,0x18,0x00,0x00};
            _glyphs['['] = new byte[] {0x3C,0x20,0x20,0x20,0x20,0x20,0x3C,0x00};
            _glyphs[']'] = new byte[] {0x3C,0x04,0x04,0x04,0x04,0x04,0x3C,0x00};
            _glyphs['{'] = new byte[] {0x0C,0x10,0x10,0x20,0x10,0x10,0x0C,0x00};
            _glyphs['}'] = new byte[] {0x30,0x08,0x08,0x04,0x08,0x08,0x30,0x00};
            _glyphs['|'] = new byte[] {0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x00};
            _glyphs['\\'] = new byte[] {0x40,0x20,0x10,0x08,0x04,0x02,0x01,0x00};
            _glyphs[':'] = new byte[] {0x00,0x18,0x18,0x00,0x18,0x18,0x00,0x00};
            _glyphs[';'] = new byte[] {0x00,0x18,0x18,0x00,0x18,0x10,0x00,0x00};
            _glyphs['"'] = new byte[] {0x24,0x24,0x00,0x00,0x00,0x00,0x00,0x00};
            _glyphs['\''] = new byte[] {0x18,0x18,0x00,0x00,0x00,0x00,0x00,0x00};
            _glyphs['<'] = new byte[] {0x08,0x10,0x20,0x40,0x20,0x10,0x08,0x00};
            _glyphs['>'] = new byte[] {0x20,0x10,0x08,0x04,0x08,0x10,0x20,0x00};
            _glyphs['/'] = new byte[] {0x02,0x04,0x08,0x10,0x20,0x40,0x00,0x00};
            _glyphs['~'] = new byte[] {0x00,0x00,0x42,0x62,0x12,0x0A,0x06,0x00};
            _glyphs['`'] = new byte[] {0x10,0x08,0x04,0x00,0x00,0x00,0x00,0x00};
            _glyphs['0'] = new byte[] {0x3C,0x42,0x46,0x4A,0x52,0x62,0x42,0x3C};
            _glyphs['1'] = new byte[] {0x08,0x18,0x28,0x08,0x08,0x08,0x08,0x3E};
            _glyphs['2'] = new byte[] {0x3C,0x42,0x02,0x1C,0x20,0x40,0x42,0x7E};
            _glyphs['3'] = new byte[] {0x3C,0x42,0x02,0x1C,0x02,0x02,0x42,0x3C};
            _glyphs['4'] = new byte[] {0x04,0x0C,0x14,0x24,0x44,0x7E,0x04,0x04};
            _glyphs['5'] = new byte[] {0x7E,0x40,0x40,0x7C,0x02,0x02,0x42,0x3C};
            _glyphs['6'] = new byte[] {0x1C,0x20,0x40,0x7C,0x42,0x42,0x42,0x3C};
            _glyphs['7'] = new byte[] {0x7E,0x42,0x04,0x08,0x10,0x10,0x10,0x10};
            _glyphs['8'] = new byte[] {0x3C,0x42,0x42,0x3C,0x42,0x42,0x42,0x3C};
            _glyphs['9'] = new byte[] {0x3C,0x42,0x42,0x42,0x3E,0x02,0x04,0x38};
            _glyphs['A'] = new byte[] {0x18,0x24,0x24,0x24,0x3C,0x24,0x24,0x24};
            _glyphs['B'] = new byte[] {0x78,0x24,0x24,0x38,0x24,0x24,0x24,0x78};
            _glyphs['C'] = new byte[] {0x3C,0x42,0x40,0x40,0x40,0x40,0x42,0x3C};
            _glyphs['D'] = new byte[] {0x78,0x24,0x22,0x22,0x22,0x22,0x24,0x78};
            _glyphs['E'] = new byte[] {0x7E,0x40,0x40,0x7C,0x40,0x40,0x40,0x7E};
            _glyphs['F'] = new byte[] {0x7E,0x40,0x40,0x7C,0x40,0x40,0x40,0x40};
            _glyphs['G'] = new byte[] {0x3C,0x42,0x40,0x4E,0x42,0x42,0x42,0x3C};
            _glyphs['H'] = new byte[] {0x42,0x42,0x42,0x7E,0x42,0x42,0x42,0x42};
            _glyphs['I'] = new byte[] {0x3C,0x10,0x10,0x10,0x10,0x10,0x10,0x3C};
            _glyphs['J'] = new byte[] {0x1E,0x08,0x08,0x08,0x08,0x08,0x48,0x30};
            _glyphs['K'] = new byte[] {0x42,0x44,0x48,0x70,0x48,0x44,0x42,0x42};
            _glyphs['L'] = new byte[] {0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x7E};
            _glyphs['M'] = new byte[] {0x42,0x66,0x5A,0x5A,0x42,0x42,0x42,0x42};
            _glyphs['N'] = new byte[] {0x42,0x62,0x52,0x4A,0x46,0x42,0x42,0x42};
            _glyphs['O'] = new byte[] {0x3C,0x42,0x42,0x42,0x42,0x42,0x42,0x3C};
            _glyphs['P'] = new byte[] {0x3C,0x42,0x42,0x3C,0x40,0x40,0x40,0x40};
            _glyphs['Q'] = new byte[] {0x3C,0x42,0x42,0x42,0x4A,0x44,0x3A,0x00};
            _glyphs['R'] = new byte[] {0x3C,0x42,0x42,0x3C,0x48,0x44,0x42,0x42};
            _glyphs['S'] = new byte[] {0x3C,0x42,0x40,0x3C,0x02,0x02,0x42,0x3C};
            _glyphs['T'] = new byte[] {0x7E,0x10,0x10,0x10,0x10,0x10,0x10,0x10};
            _glyphs['U'] = new byte[] {0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x3C};
            _glyphs['V'] = new byte[] {0x42,0x42,0x42,0x42,0x42,0x42,0x24,0x18};
            _glyphs['W'] = new byte[] {0x42,0x42,0x42,0x5A,0x5A,0x5A,0x66,0x42};
            _glyphs['X'] = new byte[] {0x42,0x24,0x18,0x18,0x18,0x24,0x42,0x42};
            _glyphs['Y'] = new byte[] {0x42,0x42,0x24,0x18,0x18,0x10,0x10,0x10};
            _glyphs['Z'] = new byte[] {0x7E,0x02,0x04,0x08,0x10,0x20,0x40,0x7E};
            _glyphs['$'] = new byte[] {0x24, 0x7E, 0x24, 0x24, 0x7E, 0x24, 0x24, 0x00};
            _glyphs['a'] = new byte[] {0x00,0x00,0x38,0x04,0x3C,0x44,0x3C,0x00};
            _glyphs['b'] = new byte[] {0x40,0x40,0x78,0x44,0x44,0x44,0x78,0x00};
            _glyphs['c'] = new byte[] {0x00,0x00,0x3C,0x40,0x40,0x40,0x3C,0x00};
            _glyphs['d'] = new byte[] {0x04,0x04,0x3C,0x44,0x44,0x44,0x3C,0x00};
            _glyphs['e'] = new byte[] {0x00,0x00,0x3C,0x44,0x7C,0x40,0x3C,0x00};
            _glyphs['f'] = new byte[] {0x0C,0x10,0x3C,0x10,0x10,0x10,0x10,0x00};
            _glyphs['g'] = new byte[] {0x00,0x00,0x3C,0x44,0x44,0x3C,0x04,0x38};
            _glyphs['h'] = new byte[] {0x40,0x40,0x78,0x44,0x44,0x44,0x44,0x00};
            _glyphs['i'] = new byte[] {0x10,0x00,0x30,0x10,0x10,0x10,0x38,0x00};
            _glyphs['j'] = new byte[] {0x08,0x00,0x18,0x08,0x08,0x08,0x48,0x30};
            _glyphs['k'] = new byte[] {0x40,0x40,0x44,0x48,0x70,0x48,0x44,0x00};
            _glyphs['l'] = new byte[] {0x30,0x10,0x10,0x10,0x10,0x10,0x38,0x00};
            _glyphs['m'] = new byte[] {0x00,0x00,0x68,0x54,0x54,0x54,0x54,0x00};
            _glyphs['n'] = new byte[] {0x00,0x00,0x78,0x44,0x44,0x44,0x44,0x00};
            _glyphs['o'] = new byte[] {0x00,0x00,0x3C,0x44,0x44,0x44,0x3C,0x00};
            _glyphs['p'] = new byte[] {0x00,0x00,0x78,0x44,0x44,0x78,0x40,0x40};
            _glyphs['q'] = new byte[] {0x00,0x00,0x3C,0x44,0x44,0x3C,0x04,0x04};
            _glyphs['r'] = new byte[] {0x00,0x00,0x78,0x44,0x40,0x40,0x40,0x00};
            _glyphs['s'] = new byte[] {0x00,0x00,0x3C,0x40,0x3C,0x04,0x78,0x00};
            _glyphs['t'] = new byte[] {0x10,0x10,0x3C,0x10,0x10,0x10,0x0C,0x00};
            _glyphs['u'] = new byte[] {0x00,0x00,0x44,0x44,0x44,0x44,0x3C,0x00};
            _glyphs['v'] = new byte[] {0x00,0x00,0x44,0x44,0x44,0x28,0x10,0x00};
            _glyphs['w'] = new byte[] {0x00,0x00,0x54,0x54,0x54,0x54,0x28,0x00};
            _glyphs['x'] = new byte[] {0x00,0x00,0x44,0x28,0x10,0x28,0x44,0x00};
            _glyphs['y'] = new byte[] {0x00,0x00,0x44,0x44,0x44,0x3C,0x04,0x38};
            _glyphs['z'] = new byte[] {0x00,0x00,0x7C,0x08,0x10,0x20,0x7C,0x00};
        }

        public byte[] GetGlyph(char c)
        {
            if (_glyphs.TryGetValue(c, out var g)) return g;
            // Fallback: try uppercase mapping for lowercase input
            var up = char.ToUpperInvariant(c);
            if (_glyphs.TryGetValue(up, out var gu)) return gu;
            return _glyphs[' '];
        }
    }
}
